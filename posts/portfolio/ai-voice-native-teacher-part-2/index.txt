1:"$Sreact.fragment"
2:I[1901,["619","static/chunks/619-ba102abea3e3d0e4.js","129","static/chunks/129-91788950a704a307.js","177","static/chunks/app/layout-01445a0075f6b145.js"],"ThemeProvider"]
3:I[2619,["619","static/chunks/619-ba102abea3e3d0e4.js","23","static/chunks/23-80ecaa68f6a0b226.js","529","static/chunks/app/posts/%5Bcategory%5D/%5Bslug%5D/page-d3f34894c54af9a0.js"],""]
4:I[2235,["619","static/chunks/619-ba102abea3e3d0e4.js","129","static/chunks/129-91788950a704a307.js","177","static/chunks/app/layout-01445a0075f6b145.js"],"ThemeToggle"]
5:I[9766,[],""]
6:I[8924,[],""]
c:I[7150,[],""]
:HL["/_next/static/css/d5ebba4595249be0.css","style"]
0:{"P":null,"b":"rq94cetZS17rr6VXyxt_m","p":"","c":["","posts","portfolio","ai-voice-native-teacher-part-2",""],"i":false,"f":[[["",{"children":["posts",{"children":[["category","portfolio","d"],{"children":[["slug","ai-voice-native-teacher-part-2","d"],{"children":["__PAGE__",{}]}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/d5ebba4595249be0.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"ko","suppressHydrationWarning":true,"children":["$","body",null,{"children":["$","$L2",null,{"attribute":"class","defaultTheme":"system","enableSystem":true,"disableTransitionOnChange":true,"children":[["$","header",null,{"className":"sticky top-0 z-50 bg-background/80 backdrop-blur-sm border-b","children":["$","div",null,{"className":"container mx-auto flex justify-between items-center py-4 px-6","children":[["$","$L3",null,{"href":"/","className":"flex items-center gap-2 text-xl font-bold hover:text-primary transition-colors","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-file-text h-5 w-5","aria-hidden":"true","children":[["$","path","1rqfz7",{"d":"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["$","path","tnqrlb",{"d":"M14 2v4a2 2 0 0 0 2 2h4"}],["$","path","b1mrlr",{"d":"M10 9H8"}],["$","path","t4e002",{"d":"M16 13H8"}],["$","path","z1uh3a",{"d":"M16 17H8"}],"$undefined"]}],"Blog"]}],["$","nav",null,{"className":"flex items-center gap-6","children":[["$","$L3",null,{"href":"/","className":"text-sm hover:text-primary transition-colors","children":"í™ˆ"}],["$","$L3",null,{"href":"/tags","className":"text-sm hover:text-primary transition-colors","children":"íƒœê·¸"}],["$","$L3",null,{"href":"/about","className":"text-sm hover:text-primary transition-colors","children":"ì†Œê°œ"}],["$","a",null,{"href":"https://github.com/DevONew","target":"_blank","rel":"noopener noreferrer","className":"hover:text-primary transition-colors","aria-label":"GitHub","children":["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-github h-5 w-5","aria-hidden":"true","children":[["$","path","tonef",{"d":"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"}],["$","path","9comsn",{"d":"M9 18c-4.51 2-5-2-7-2"}],"$undefined"]}]}],["$","$L4",null,{}]]}]]}]}],["$","main",null,{"className":"container mx-auto py-8 px-6","children":["$","$L5",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}],["$","footer",null,{"className":"border-t mt-8 py-6 px-6","children":["$","div",null,{"className":"container mx-auto text-center","children":["$","p",null,{"className":"text-sm text-muted-foreground","children":["Â© ",2026," DevONew Blog. All rights reserved."]}]}]}]]}]}]}]]}],{"children":["posts","$L7",{"children":[["category","portfolio","d"],"$L8",{"children":[["slug","ai-voice-native-teacher-part-2","d"],"$L9",{"children":["__PAGE__","$La",{},null,false]},null,false]},null,false]},null,false]},null,false],"$Lb",false]],"m":"$undefined","G":["$c",[]],"s":false,"S":true}
e:I[4431,[],"OutletBoundary"]
10:I[5278,[],"AsyncMetadataOutlet"]
12:I[4431,[],"ViewportBoundary"]
14:I[4431,[],"MetadataBoundary"]
15:"$Sreact.suspense"
7:["$","$1","c",{"children":[null,["$","$L5",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}]
8:["$","$1","c",{"children":[null,["$","$L5",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}]
9:["$","$1","c",{"children":[null,["$","$L5",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}]
a:["$","$1","c",{"children":["$Ld",null,["$","$Le",null,{"children":["$Lf",["$","$L10",null,{"promise":"$@11"}]]}]]}]
b:["$","$1","h",{"children":[null,[["$","$L12",null,{"children":"$L13"}],null],["$","$L14",null,{"children":["$","div",null,{"hidden":true,"children":["$","$15",null,{"fallback":null,"children":"$L16"}]}]}]]}]
17:I[6905,["619","static/chunks/619-ba102abea3e3d0e4.js","23","static/chunks/23-80ecaa68f6a0b226.js","529","static/chunks/app/posts/%5Bcategory%5D/%5Bslug%5D/page-d3f34894c54af9a0.js"],"default"]
18:T3345,
## Part 1ì—ì„œëŠ”...

Part 1ì—ì„œëŠ” í”„ë¡œì íŠ¸ ê°œìš”ì™€ ìƒíƒœ ê´€ë¦¬ë¥¼ ë‹¤ë¤˜ìŠµë‹ˆë‹¤. Part 2ì—ì„œëŠ” listening, processing, speakingì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

## listening ìƒíƒœ - ìŒì„± ì¸ì‹ ì¤‘

![ë“£ëŠ” ì¤‘](/image/listening.png)

ì‚¬ìš©ìê°€ ë§ˆì´í¬ ë²„íŠ¼ì„ íƒ­í•˜ë©´ ìŒì„± ë…¹ìŒì´ ì‹œì‘ë˜ê³ , ì‹¤ì‹œê°„ìœ¼ë¡œ ìŒëŸ‰ì„ ë¶„ì„í•˜ì—¬ ì‹œê°ì  í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤.

**listening ìƒíƒœì—ì„œëŠ” ì„¸ ê°€ì§€ í•µì‹¬ ê¸°ìˆ ì´ ë™ì‘í•©ë‹ˆë‹¤.** 
- Web Audio APIì˜ `AnalyserNode`ë¡œ ì‹¤ì‹œê°„ ìŒëŸ‰ì„ ë¶„ì„í•˜ì—¬ ë²„íŠ¼ í¬ê¸°ë¥¼ ë™ì ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤. 
- 2ì´ˆê°„ ì¹¨ë¬µì´ ì§€ì†ë˜ë©´ ìë™ìœ¼ë¡œ ë…¹ìŒì„ ì¤‘ì§€í•˜ì—¬ ì‚¬ìš©ìê°€ ë§¤ë²ˆ ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆ„ë¥¼ í•„ìš”ê°€ ì—†ë„ë¡ í–ˆìŠµë‹ˆë‹¤. 
- ë§ˆì§€ë§‰ìœ¼ë¡œ ElevenLabs STTë¥¼ ì‚¬ìš©í•˜ì—¬ í•œêµ­ì–´, ì˜ì–´, ì¼ë³¸ì–´ ë“± ë‹¤êµ­ì–´ë¥¼ ë™ì‹œì— ì¸ì‹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¬¸ì œ: Web Speech APIì˜ í•œê³„

ì´ˆê¸°ì—ëŠ” ë¸Œë¼ìš°ì € ë‚´ì¥ Web Speech APIë¥¼ ì‚¬ìš©í–ˆìœ¼ë‚˜, í•œ ë²ˆì— í•˜ë‚˜ì˜ ì–¸ì–´ë§Œ ì¸ì‹ ê°€ëŠ¥í•œ ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì™¸êµ­ì–´ë¡œ ì§ˆë¬¸í•˜ë©´ STTë¥¼ í•œêµ­ì–´(`ko-KR`)ë¡œ ì„¤ì •í–ˆì„ ë•Œ ì˜ì–´ ë°œìŒì„ í•œê¸€ë¡œ ì˜ëª» ì¸ì‹í–ˆê³ , ì˜ì–´(`en-US`)ë¡œ ë°”ê¾¸ë©´ ì´ë²ˆì—” í•œêµ­ì–´ê°€ ì œëŒ€ë¡œ ì¸ì‹ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì–´ë–¤ ì–¸ì–´ë¡œ ë§í• ì§€ ì˜ˆì¸¡í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—, ë‹¤êµ­ì–´ ë™ì‹œ ì¸ì‹ì´ ê°€ëŠ¥í•œ ElevenLabs Scribe v2ë¡œ ì „í™˜í–ˆìŠµë‹ˆë‹¤.

### ElevenLabs STT êµ¬í˜„

ElevenLabs Scribe v2ëŠ” `language_codes` íŒŒë¼ë¯¸í„°ì— ì—¬ëŸ¬ ì–¸ì–´ë¥¼ ë™ì‹œì— ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ í•œêµ­ì–´ë¥¼ ê¸°ë³¸ìœ¼ë¡œ í•˜ë˜, ì‚¬ìš©ìê°€ í˜„ì¬ í•™ìŠµ ì¤‘ì¸ ì–¸ì–´(í”„ë‘ìŠ¤ì–´, ì¼ë³¸ì–´ ë“±)ë¥¼ ì¶”ê°€ë¡œ ì„¤ì •í•˜ë©´ ë‘ ì–¸ì–´ë¥¼ ë™ì‹œì— ì¸ì‹í•©ë‹ˆë‹¤.

```typescript
// app/api/stt/route.ts
export async function POST(request: Request) {
  const sttFormData = new FormData();
  sttFormData.append('file', audioFile);
  sttFormData.append('model_id', 'scribe_v2');

  // ë‹¤êµ­ì–´ ë™ì‹œ ì¸ì‹ (í•œêµ­ì–´ + í˜„ì¬ í•™ìŠµ ì¤‘ì¸ ì–¸ì–´)
  sttFormData.append('language_codes', 'ko');
  if (currentLanguage && currentLanguage !== 'ko') {
    sttFormData.append('language_codes', currentLanguage);
  }

  const response = await fetch('https://api.elevenlabs.io/v1/speech-to-text', {
    method: 'POST',
    headers: { 'xi-api-key': process.env.ELEVENLABS_API_KEY },
    body: sttFormData,
  });

  return Response.json({ text: result.text });
}
```

ì‚¬ìš©ìê°€ "How do you say thank you in French?"ë¼ê³  ì˜ì–´ë¡œ ë§í•˜ë“ , "í”„ë‘ìŠ¤ì–´ë¡œ ê°ì‚¬í•©ë‹ˆë‹¤ ì–´ë–»ê²Œ ë§í•´?"ë¼ê³  í•œêµ­ì–´ë¡œ ë§í•˜ë“  ì •í™•í•˜ê²Œ ì¸ì‹ë©ë‹ˆë‹¤.

### ì‹¤ì‹œê°„ ìŒëŸ‰ ë¶„ì„ ë° ì‹œê°í™”

ì‚¬ìš©ìê°€ ë§í•˜ëŠ” ë™ì•ˆ ë²„íŠ¼ í¬ê¸°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€í™”ì‹œì¼œ ì‹œê°ì  í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤. Web Audio APIì˜ `AnalyserNode`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì£¼íŒŒìˆ˜ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ê³ , ì´ë¥¼ 0-100 ë²”ìœ„ë¡œ ì •ê·œí™”í•œ í›„ ë²„íŠ¼ì˜ `scale` ê°’ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

```typescript
// app/hooks/useVoiceRecorderStreaming.ts
const updateVolume = useCallback(() => {
  const dataArray = new Uint8Array(analyserRef.current.frequencyBinCount);
  analyserRef.current.getByteFrequencyData(dataArray);

  // í‰ê·  ìŒëŸ‰ ê³„ì‚° (0-255 â†’ 0-100)
  const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
  const normalizedVolume = Math.min(100, (average / 255) * 100);

  setVolumeLevel(normalizedVolume);
  animationFrameRef.current = requestAnimationFrame(updateVolume);
}, []);
```

ê³„ì‚°ëœ ìŒëŸ‰ ê°’ì„ ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬í•˜ë©´, ìŒëŸ‰ì´ ë†’ì„ìˆ˜ë¡ ë²„íŠ¼ì´ ì»¤ì§€ê³ (ìµœëŒ€ 1.1ë°°), ë‚®ì„ìˆ˜ë¡ ì‘ì•„ì§‘ë‹ˆë‹¤(ìµœì†Œ 0.8ë°°).

```typescript
// app/components/VoiceButton.tsx
<VoiceButton
  scale={Math.min(0.8 + (volumeLevel / 100) * 0.3, 1.1)}
  isListening={true}
/>
```

### ì¹¨ë¬µ ê°ì§€ ìë™ ì¢…ë£Œ

ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•˜ê¸° ìœ„í•´ ì¹¨ë¬µ ê°ì§€ ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ë§ì„ ë§ˆì¹˜ê³  2ì´ˆ ë™ì•ˆ ì¹¨ë¬µì´ ì§€ì†ë˜ë©´ ìë™ìœ¼ë¡œ ë…¹ìŒì„ ì¤‘ì§€í•˜ì—¬, ë§¤ë²ˆ ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆŒëŸ¬ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤.

```typescript
// app/hooks/useVoiceRecorderStreaming.ts
const setupSilenceDetection = useCallback((mediaRecorder: MediaRecorder) => {
  const checkSilence = () => {
    if (lastVolumeRef.current < AUDIO_CONFIG.SILENCE_THRESHOLD) {
      mediaRecorder.stop();  // ì¹¨ë¬µ ê°ì§€ â†’ ìë™ ì¤‘ì§€
    } else {
      // ìŒì„± ìˆìœ¼ë©´ íƒ€ì´ë¨¸ ë¦¬ì…‹
      silenceTimeoutRef.current = setTimeout(checkSilence, AUDIO_CONFIG.SILENCE_DURATION);
    }
  };

  silenceTimeoutRef.current = setTimeout(checkSilence, AUDIO_CONFIG.SILENCE_DURATION);
}, []);
```

ì¹¨ë¬µ íŒë‹¨ ê¸°ì¤€ì€ ìŒëŸ‰ 15 ì´í•˜(0-100 ìŠ¤ì¼€ì¼)ì´ë©°, ì´ ìƒíƒœê°€ 2000ms(2ì´ˆ) ì§€ì†ë˜ë©´ ë…¹ìŒì„ ì¢…ë£Œí•©ë‹ˆë‹¤.

```typescript
// app/constants/audio.ts
export const AUDIO_CONFIG = {
  SILENCE_THRESHOLD: 15,    // ì¹¨ë¬µ íŒë‹¨ ìŒëŸ‰ (0-100 ì¤‘ 15 ì´í•˜)
  SILENCE_DURATION: 2000,   // 2ì´ˆê°„ ì¹¨ë¬µ ì§€ì† ì‹œ ìë™ ì¢…ë£Œ
  FFT_SIZE: 256,
};
```

### STT ê²°ê³¼ 2ì´ˆê°„ í‘œì‹œ

ë…¹ìŒì´ ì¢…ë£Œëœ í›„ STT ê²°ê³¼ë¥¼ ì¦‰ì‹œ Chat APIë¡œ ë³´ë‚´ì§€ ì•Šê³ , 2ì´ˆê°„ í™”ë©´ì— í‘œì‹œí•˜ì—¬ ì‚¬ìš©ìê°€ ìì‹ ì´ ë§í•œ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‚¬ìš©ìê°€ ìŒì„± ì¸ì‹ì´ ì œëŒ€ë¡œ ë˜ì—ˆëŠ”ì§€ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆì–´ UXë¥¼ í¬ê²Œ ê°œì„ í•©ë‹ˆë‹¤.

```typescript
// STT ì™„ë£Œ ì‹œ
setTranscript(recognizedText);

// 2ì´ˆ ë™ì•ˆ listening ìƒíƒœ ìœ ì§€ (ì‚¬ìš©ìê°€ í™•ì¸)
setTimeout(() => {
  setAppState('processing');  // ì´ì œ Chat API í˜¸ì¶œ
  onFinalTranscript(recognizedText);
}, 2000);
```

## processing ìƒíƒœ - AI ì‘ë‹µ ìƒì„±

![ìƒê°í•˜ëŠ” ì¤‘](/image/thinking.png)

STTë¡œ ë³€í™˜ëœ í…ìŠ¤íŠ¸ë¥¼ Claude AIì—ê²Œ ë³´ë‚´ ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” "ìƒê°í•˜ëŠ” ì¤‘.." ë©”ì‹œì§€ë¥¼ ë³´ë©° ëŒ€ê¸°í•˜ì§€ë§Œ, ë‚´ë¶€ì ìœ¼ë¡œëŠ” Chat API í˜¸ì¶œê³¼ ì–¸ì–´ ê°ì§€ê°€ ì§„í–‰ë©ë‹ˆë‹¤.

### Claude API í˜¸ì¶œ

STTë¡œ ë³€í™˜ëœ í…ìŠ¤íŠ¸ëŠ” Anthropicì˜ Claude APIë¡œ ì „ì†¡ë©ë‹ˆë‹¤. í˜„ì¬ ëŒ€í™” íˆìŠ¤í† ë¦¬ì™€ ìƒˆë¡œìš´ ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ í•¨ê»˜ ë³´ë‚´ë©´, Claudeê°€ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´í•´í•˜ê³  ì ì ˆí•œ ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤. ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ëŠ” ì–¸ì–´ ì„ ìƒë‹˜ ì—­í• ì„ í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©°, Prompt Cachingì„ ì‚¬ìš©í•˜ì—¬ API ë¹„ìš©ì„ ì ˆê°í•©ë‹ˆë‹¤(ìì„¸í•œ ë‚´ìš©ì€ Part 3ì—ì„œ ë‹¤ë£¹ë‹ˆë‹¤).

```typescript
// app/api/chat/route.ts
export async function POST(request: Request) {
  const { message, conversationHistory = [] } = await request.json();

  const response = await anthropic.messages.create({
    model: 'claude-sonnet-4-20250514',
    max_tokens: 200,
    system: [
      {
        type: 'text',
        text: SYSTEM_PROMPT,
        cache_control: { type: 'ephemeral' },  // í”„ë¡¬í”„íŠ¸ ìºì‹± (Part 3ì—ì„œ ìì„¸íˆ)
      },
    ],
    messages: [...conversationHistory, { role: 'user', content: message }],
  });

  return Response.json({ response: response.content[0].text });
}
```

### useChatHandler í›… - Chatê³¼ TTS ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜

`useChatHandler`ëŠ” STT ê²°ê³¼ë¥¼ ë°›ì•„ Chat API í˜¸ì¶œ, ì–¸ì–´ ê°ì§€, TTS ì²˜ë¦¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì—­í• ì„ í•©ë‹ˆë‹¤. ë¨¼ì € ì‚¬ìš©ì ì…ë ¥ì—ì„œ ì–¸ì–´ë¥¼ ê°ì§€í•˜ì—¬ STT ì„¤ì •ì„ ì—…ë°ì´íŠ¸í•˜ê³ , Chat APIë¡œ ì‘ë‹µì„ ë°›ì€ í›„ ì¦‰ì‹œ TTS APIë¥¼ í˜¸ì¶œí•˜ì—¬ ìŒì„±ì„ ìƒì„±í•©ë‹ˆë‹¤. ëª¨ë“  ì¤€ë¹„ê°€ ì™„ë£Œë˜ë©´ `speaking` ìƒíƒœë¡œ ì „í™˜í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ìŒì„±ì„ ì¬ìƒí•©ë‹ˆë‹¤.

```typescript
// app/hooks/useChatHandler.ts
const handleFinalTranscript = useCallback((finalText: string) => {
  // 1. ì‚¬ìš©ì ì…ë ¥ì—ì„œ ì–¸ì–´ ê°ì§€
  const detectedLanguage = detectLanguage(finalText);
  if (detectedLanguage) onLanguageDetected(detectedLanguage);

  // 2. Chat API í˜¸ì¶œ â†’ 3. TTS ì²˜ë¦¬ â†’ 4. speaking ìƒíƒœ ì „í™˜
  handleChatAPI(finalText, conversationHistory)
    .then(async (aiResponse) => {
      onResponseReceived(aiResponse);
      const audioBlob = await handleTTSAPI(aiResponse);

      setTimeout(() => {
        onStateChange('speaking');
        onAudioGenerated(audioBlob);
      }, 200);
    })
    .catch(onError);
}, [conversationHistory, handleChatAPI, handleTTSAPI]);
```

### ì–¸ì–´ ìë™ ê°ì§€

ì‚¬ìš©ìê°€ "í”„ë‘ìŠ¤ì–´ë¡œ ë§í•´ì¤˜" ë˜ëŠ” íŠ¹ì • ì–¸ì–´ë¥¼ ì–¸ê¸‰í•˜ë©´, í•´ë‹¹ ì–¸ì–´ë¥¼ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ STT/TTS ì„¤ì •ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. ê°„ë‹¨í•œ í‚¤ì›Œë“œ ë§¤ì¹­ ë°©ì‹ì„ ì‚¬ìš©í•˜ë©°, í•œêµ­ì–´ì™€ ì˜ì–´ ëª¨ë‘ ì§€ì›í•©ë‹ˆë‹¤.

```typescript
// app/utils/language-detector.ts
export const LANGUAGE_MAP: { [key: string]: string } = {
  'í”„ë‘ìŠ¤': 'fr', 'í”„ë‘ìŠ¤ì–´': 'fr', 'france': 'fr',
  'ì¼ë³¸': 'ja', 'ì¼ë³¸ì–´': 'ja', 'japan': 'ja',
  'ìŠ¤í˜ì¸': 'es', 'ì´íƒˆë¦¬ì•„': 'it',
};

export function detectLanguage(text: string): string | undefined {
  const lowerText = text.toLowerCase();

  for (const [key, code] of Object.entries(LANGUAGE_MAP)) {
    if (lowerText.includes(key)) return code;
  }

  return undefined;
}
```

ì˜ˆë¥¼ ë“¤ì–´ ì‚¬ìš©ìê°€ "ì´íƒˆë¦¬ì•„ ì—¬í–‰ ë¬¸ì¥ ì•Œë ¤ì¤˜"ë¼ê³  ë§í•˜ë©´ `it` ì½”ë“œê°€ ê°ì§€ë˜ê³ , ì´í›„ Claudeê°€ "Buongiorno! Come stai?"ë¼ê³  ë‹µë³€í•˜ë©´ STTê°€ ì´íƒˆë¦¬ì•„ì–´ë¡œ ì„¤ì •ë˜ì–´ ì •í™•í•œ ë°œìŒ ì¸ì‹ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.

## speaking ìƒíƒœ - TTS ë° ì˜¤ë””ì˜¤ ì¬ìƒ

![ë‹µë³€](/image/answer.png)

AI ì‘ë‹µì´ ìƒì„±ë˜ë©´ ElevenLabs TTS APIë¥¼ í˜¸ì¶œí•´ ìŒì„±ìœ¼ë¡œ ë³€í™˜í•˜ê³  ì¬ìƒí•©ë‹ˆë‹¤.

### ElevenLabs TTS API í˜¸ì¶œ

Claudeì˜ ì‘ë‹µ í…ìŠ¤íŠ¸ë¥¼ ElevenLabs TTS APIë¡œ ì „ì†¡í•˜ì—¬ ìì—°ìŠ¤ëŸ¬ìš´ ìŒì„±ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. `eleven_multilingual_v2` ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤êµ­ì–´ë¥¼ ì§€ì›í•˜ë©°, Safari ë¸Œë¼ìš°ì €ì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´ `mp3_44100_128` í¬ë§·ê³¼ `Accept-Ranges: bytes` í—¤ë”ë¥¼ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.

```typescript
// app/api/tts/route.ts
export async function POST(request: Request) {
  const { text, voiceId = 'XB0fDUnXU5powFXDhCwa' } = await request.json();

  const response = await fetch(
    `https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`,
    {
      method: 'POST',
      headers: {
        'xi-api-key': process.env.ELEVENLABS_API_KEY,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        text,
        model_id: 'eleven_multilingual_v2',  // ë‹¤êµ­ì–´ ì§€ì›
        output_format: 'mp3_44100_128',  // Safari í˜¸í™˜ì„±
      }),
    }
  );

  const audioBuffer = await response.arrayBuffer();

  return new Response(audioBuffer, {
    headers: {
      'Content-Type': 'audio/mpeg',
      'Accept-Ranges': 'bytes',  // Safari í•„ìˆ˜ í—¤ë”
    },
  });
}
```

### ë¬¸ì œ: iOS Safariì—ì„œ ì†Œë¦¬ê°€ ì•ˆ ë‚˜ì˜¤ëŠ” ì´ìŠˆ

ë°ìŠ¤í¬í†± Chromeê³¼ Firefoxì—ì„œëŠ” ì •ìƒ ì‘ë™í–ˆì§€ë§Œ, iOS Safariì—ì„œë§Œ ìŒì„±ì´ ì¬ìƒë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. iOSëŠ” ë³´ì•ˆê³¼ ë°ì´í„° ì ˆì•½ì„ ìœ„í•´ ì‚¬ìš©ìì˜ ëª…ì‹œì ì¸ ì¸í„°ë™ì…˜ ì—†ì´ ìë™ìœ¼ë¡œ ì˜¤ë””ì˜¤ë¥¼ ì¬ìƒí•˜ëŠ” ê²ƒì„ ì œí•œí•©ë‹ˆë‹¤. ë˜í•œ `<audio>` íƒœê·¸ì— `playsInline` ì†ì„±ì´ ì—†ìœ¼ë©´ ì „ì²´í™”ë©´ ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ë¡œ ì „í™˜ë˜ê±°ë‚˜ ì¬ìƒì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ `load()` ë©”ì„œë“œë¥¼ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ iOS Safariì—ì„œ ì˜¤ë””ì˜¤ ì†ŒìŠ¤ê°€ ì œëŒ€ë¡œ ë¡œë“œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„¸ ê°€ì§€ ì¡°ì¹˜ë¥¼ ì·¨í–ˆìŠµë‹ˆë‹¤. ë¨¼ì € `<audio>` íƒœê·¸ì— `playsInline` ì†ì„±ì„ ì¶”ê°€í•˜ì—¬ iOSì—ì„œ ì „ì²´í™”ë©´ ëª¨ë“œë¡œ ì „í™˜ë˜ì§€ ì•Šë„ë¡ í–ˆìŠµë‹ˆë‹¤.

```tsx
// app/components/AudioPlayer.tsx
<audio
  ref={audioRef}
  playsInline        // iOS ì „ì²´í™”ë©´ ë°©ì§€ (í•„ìˆ˜!)
  preload="auto"
  onEnded={handleAudioEnd}
/>
```

ë‹¤ìŒìœ¼ë¡œ ì˜¤ë””ì˜¤ ì†ŒìŠ¤ë¥¼ ì„¤ì •í•œ í›„ `load()` ë©”ì„œë“œë¥¼ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•˜ì—¬ iOS Safariì—ì„œ ì˜¤ë””ì˜¤ íŒŒì¼ì´ ì œëŒ€ë¡œ ë¡œë“œë˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.

```typescript
// app/components/AudioPlayer.tsx
useEffect(() => {
  if (isPlaying && audioBlob) {
    const audioUrl = URL.createObjectURL(audioBlob);
    audioRef.current.src = audioUrl;

    audioRef.current.load();  // iOS Safari í•„ìˆ˜
    audioRef.current.play().catch(console.error);
  }
}, [isPlaying, audioBlob]);
```

ë§ˆì§€ë§‰ìœ¼ë¡œ í”Œë«í¼ ê°ì§€ ìœ í‹¸ë¦¬í‹°ë¥¼ ë§Œë“¤ì–´ iOS ê¸°ê¸°ì™€ Safari ë¸Œë¼ìš°ì €ë¥¼ ì •í™•í•˜ê²Œ ì‹ë³„í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤. iOS 13+ iPadëŠ” ë°ìŠ¤í¬í†± User-Agentë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ `ontouchend` ì´ë²¤íŠ¸ ì¡´ì¬ ì—¬ë¶€ë¡œ ì¶”ê°€ í™•ì¸í•©ë‹ˆë‹¤.

```typescript
// app/utils/platform-detect.ts
export const isIOS = (): boolean => {
  const ua = window.navigator.userAgent;
  const isIOSDevice = /iPad|iPhone|iPod/.test(ua);
  const isIPadOS = ua.includes('Mac') && 'ontouchend' in document;

  return isIOSDevice || isIPadOS;
};

export const isIOSSafari = (): boolean => {
  return isIOS() && /Safari/.test(ua) && !/Chrome/.test(ua);
};
```

ì´ì œ iOS Safarië¥¼ í¬í•¨í•œ ëª¨ë“  ì£¼ìš” ë¸Œë¼ìš°ì €ì—ì„œ ìŒì„±ì´ ì •ìƒì ìœ¼ë¡œ ì¬ìƒë©ë‹ˆë‹¤.


Part 3ì—ì„œëŠ” ëŒ€í™” íˆìŠ¤í† ë¦¬ ê´€ë¦¬, TTS ìºì‹±, Prompt Cachingì„ í†µí•œ ë¹„ìš© ìµœì í™”, ì‚¬ìš© ì œí•œ ëª¨ë‹¬ êµ¬í˜„, ê·¸ë¦¬ê³  í”„ë¡œì íŠ¸ íšŒê³ ë¥¼ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤.d:["$","main",null,{"children":["$","div",null,{"className":"max-w-4xl mx-auto px-4 py-8","children":["$","article",null,{"children":[["$","header",null,{"className":"mb-12","children":[["$","h1",null,{"className":"text-5xl font-bold mb-6","children":"AI ìŒì„± ì›ì–´ë¯¼ ì„ ìƒë‹˜ ë§Œë“¤ê¸° Part 2: ìŒì„± ì¸ì‹ê³¼ AI ëŒ€í™” ì²˜ë¦¬"}],["$","div",null,{"className":"flex flex-wrap items-center gap-4","children":[["$","div",null,{"className":"flex items-center gap-2 text-muted-foreground","children":[["$","span",null,{"children":"ğŸ“…"}],["$","time",null,{"children":"2025ë…„ 12ì›” 11ì¼"}]]}],["$","div",null,{"className":"flex flex-wrap gap-2","children":[["$","$L3","í¬íŠ¸í´ë¦¬ì˜¤",{"href":"/tags/%ED%8F%AC%ED%8A%B8%ED%8F%B4%EB%A6%AC%EC%98%A4","className":"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-accent text-accent-foreground hover:bg-accent/80 transition-colors","children":"í¬íŠ¸í´ë¦¬ì˜¤"}],["$","$L3","AI",{"href":"/tags/AI","className":"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-accent text-accent-foreground hover:bg-accent/80 transition-colors","children":"AI"}],["$","$L3","Next.js",{"href":"/tags/Next.js","className":"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-accent text-accent-foreground hover:bg-accent/80 transition-colors","children":"Next.js"}],["$","$L3","React",{"href":"/tags/React","className":"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-accent text-accent-foreground hover:bg-accent/80 transition-colors","children":"React"}],["$","$L3","ElevenLabs",{"href":"/tags/ElevenLabs","className":"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-accent text-accent-foreground hover:bg-accent/80 transition-colors","children":"ElevenLabs"}],["$","$L3","Claude",{"href":"/tags/Claude","className":"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-accent text-accent-foreground hover:bg-accent/80 transition-colors","children":"Claude"}]]}]]}]]}],["$","div",null,{"className":"prose dark:prose-invert prose-lg max-w-none prose-headings:font-bold prose-headings:tracking-tight prose-h1:text-4xl prose-h2:text-3xl prose-h3:text-2xl prose-p:leading-relaxed prose-p:text-foreground/90 prose-pre:bg-muted prose-pre:border prose-pre:border-border prose-pre:text-foreground prose-code:text-sm prose-code:font-mono prose-code:text-foreground prose-a:text-primary prose-a:no-underline hover:prose-a:underline","children":["$","$L17",null,{"content":"$18"}]}],"$L19","$L1a"]}]}]}]
19:["$","nav",null,{"className":"mt-12 pt-8 border-t","children":["$","div",null,{"className":"grid grid-cols-1 md:grid-cols-2 gap-6","children":[["$","$L3",null,{"href":"/posts/portfolio/ai-voice-native-teacher-part-3","className":"flex flex-col justify-center h-28 px-6 py-4 rounded-lg border border-border hover:bg-accent/50 transition-colors group","children":[["$","div",null,{"className":"text-sm text-muted-foreground mb-2","children":"â† ì´ì „ ê¸€"}],["$","div",null,{"className":"font-medium group-hover:text-primary transition-colors line-clamp-2","children":"AI ìŒì„± ì›ì–´ë¯¼ ì„ ìƒë‹˜ ë§Œë“¤ê¸° Part 3: ìµœì í™”ì™€ ì‚¬ìš© ì œí•œ êµ¬í˜„"}]]}],["$","$L3",null,{"href":"/posts/portfolio/ai-voice-native-teacher-part-1","className":"flex flex-col justify-center h-28 px-6 py-4 rounded-lg border border-border hover:bg-accent/50 transition-colors group md:text-right","children":[["$","div",null,{"className":"text-sm text-muted-foreground mb-2","children":"ë‹¤ìŒ ê¸€ â†’"}],["$","div",null,{"className":"font-medium group-hover:text-primary transition-colors line-clamp-2","children":"AI ìŒì„± ì›ì–´ë¯¼ ì„ ìƒë‹˜ ë§Œë“¤ê¸° Part 1: í”„ë¡œì íŠ¸ ê°œìš”ì™€ ìƒíƒœ ê´€ë¦¬"}]]}]]}]}]
1a:["$","nav",null,{"className":"mt-8 pt-8 border-t","children":["$","$L3",null,{"href":"/","className":"text-primary hover:underline inline-flex items-center gap-2","children":"â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°"}]}]
13:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
f:null
1b:I[622,[],"IconMark"]
11:{"metadata":[["$","title","0",{"children":"AI ìŒì„± ì›ì–´ë¯¼ ì„ ìƒë‹˜ ë§Œë“¤ê¸° Part 2: ìŒì„± ì¸ì‹ê³¼ AI ëŒ€í™” ì²˜ë¦¬ | DevONew Blog"}],["$","meta","1",{"name":"description","content":"ë‹¤êµ­ì–´ ìŒì„± í•™ìŠµ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜"}],["$","meta","2",{"property":"og:title","content":"AI ìŒì„± ì›ì–´ë¯¼ ì„ ìƒë‹˜ ë§Œë“¤ê¸° Part 2: ìŒì„± ì¸ì‹ê³¼ AI ëŒ€í™” ì²˜ë¦¬"}],["$","meta","3",{"property":"og:description","content":"ë‹¤êµ­ì–´ ìŒì„± í•™ìŠµ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜"}],["$","meta","4",{"property":"og:type","content":"article"}],["$","meta","5",{"property":"article:published_time","content":"2025-12-11"}],["$","meta","6",{"name":"twitter:card","content":"summary"}],["$","meta","7",{"name":"twitter:title","content":"AI ìŒì„± ì›ì–´ë¯¼ ì„ ìƒë‹˜ ë§Œë“¤ê¸° Part 2: ìŒì„± ì¸ì‹ê³¼ AI ëŒ€í™” ì²˜ë¦¬"}],["$","meta","8",{"name":"twitter:description","content":"ë‹¤êµ­ì–´ ìŒì„± í•™ìŠµ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜"}],["$","link","9",{"rel":"icon","href":"data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ‘¾</text></svg>"}],["$","$L1b","10",{}]],"error":null,"digest":"$undefined"}
16:"$11:metadata"
